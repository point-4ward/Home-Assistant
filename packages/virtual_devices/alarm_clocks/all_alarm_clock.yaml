###########################################################
#                                                         #
# This package creates a device that syncs all the alarm  #
# clock packages to the same time and music so we can     #
# wake up the whole house at the same time!               #
#                                                         #
###########################################################


homeassistant:
  customize:
    script.all_sync:
      icon: mdi:clock-out

    sensor.all_alarm_clock_time:
      friendly_name: 'Alarm Time'
      icon: mdi:alarm


input_number:
  all_alarm_clock_hour:
    name: Hour
    icon: mdi:timer
    initial: 7
    min: 0
    max: 23
    step: 1

  all_alarm_clock_minute:
    name: Minute
    icon: mdi:timer
    initial: 30
    min: 0
    max: 55
    step: 5


sensor:
  platform: template
  sensors:
    all_alarm_clock_hour:
      value_template: '{{ states.input_number.all_alarm_clock_hour.state | int }}'

    all_alarm_clock_minute:
      value_template: '{{ states.input_number.all_alarm_clock_minute.state | int }}'

    all_alarm_clock_time:
      value_template: >-
        {{ states.sensor.all_alarm_clock_hour.state }}:
        {%- if states.sensor.all_alarm_clock_minute.state|length == 1 -%}
        0
        {%- endif -%}
        {{ states.sensor.all_alarm_clock_minute.state }}


group:
  all_alarm_clock:
    control: hidden
    name: 'MASTER Alarm Clock'
    entities:
      - sensor.all_alarm_clock_time
      - input_number.all_alarm_clock_hour
      - input_number.all_alarm_clock_minute
      - script.all_sync


script:
  all_sync:
    alias: Sync All Alarms
    sequence:
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.downstairs_alarm_clock_hour
          value: '{{states.input_number.all_alarm_clock_hour.state | float}}'
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.boys_alarm_clock_hour
          value: '{{states.input_number.all_alarm_clock_hour.state | float}}'
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.girls_alarm_clock_hour
          value: '{{states.input_number.all_alarm_clock_hour.state | float}}'
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.masterbed_alarm_clock_hour
          value: '{{states.input_number.all_alarm_clock_hour.state | float}}'
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.downstairs_alarm_clock_minute
          value: '{{states.input_number.all_alarm_clock_minute.state | float}}'
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.boys_alarm_clock_minute
          value: '{{states.input_number.all_alarm_clock_minute.state | float}}'
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.girls_alarm_clock_minute
          value: '{{states.input_number.all_alarm_clock_minute.state | float}}'
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.masterbed_alarm_clock_minute
          value: '{{states.input_number.all_alarm_clock_minute.state | float}}'
      - service: input_boolean.turn_on
        data: 
          entity_id:
            - input_boolean.downstairs_alarm_clock_status
            - input_boolean.boys_alarm_clock_status
            - input_boolean.girls_alarm_clock_status
            - input_boolean.masterbed_alarm_clock_status
      - service: input_boolean.turn_off
        data:
          entity_id:
            - input_boolean.downstairs_alarm_clock_repeat
            - input_boolean.boys_alarm_clock_repeat
            - input_boolean.girls_alarm_clock_repeat
            - input_boolean.masterbed_alarm_clock_repeat