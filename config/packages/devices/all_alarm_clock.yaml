###########################################################
#                                                         #
# This package creates a device that syncs all the alarm  #
# clock packages to the same time and music so we can     #
# wake up the whole house at the same time!               #
#                                                         #
###########################################################


homeassistant:
  customize:
    script.all_sync:
      icon: mdi:clock-out

    sensor.all_alarm_clock_time:
      friendly_name: 'Alarm Time'
      icon: mdi:alarm


input_number:
  all_alarm_clock_hour:
    name: Hour
    icon: mdi:timer
    initial: 6
    min: 0
    max: 23
    step: 1

  all_alarm_clock_minute:
    name: Minute
    icon: mdi:timer
    initial: 15
    min: 0
    max: 55
    step: 5


input_select:
  all_alarm_sound:
    name: Music
    options:
      - Free Radio CW
      - Let Her Go
      - Nightswimming
    initial: Free Radio CW
    icon: mdi:music


sensor:
  platform: template
  sensors:
    all_alarm_clock_hour:
      value_template: '{{ states.input_number.all_alarm_clock_hour.state | int }}'

    all_alarm_clock_minute:
      value_template: '{{ states.input_number.all_alarm_clock_minute.state | int }}'

    all_alarm_clock_time:
      value_template: >-
        {{ states.sensor.all_alarm_clock_hour.state }}:
        {%- if states.sensor.all_alarm_clock_minute.state|length == 1 -%}
        0
        {%- endif -%}
        {{ states.sensor.all_alarm_clock_minute.state }}


group:
  all_alarm_clock:
    control: hidden
    name: 'MASTER Alarm Clock'
    entities:
      - input_select.all_alarm_sound
      - sensor.all_alarm_clock_time
      - input_number.all_alarm_clock_hour
      - input_number.all_alarm_clock_minute
      - script.all_sync


script:
  all_sync:
    alias: Sync All Alarms
    sequence:
      - service: input_select.select_option
        data_template:
          entity_id: input_select.livingroom_alarm_sound
          value: '{{states.input_select.all_alarm_sound.state}}'
#      - service: input_select.select_option
#        data_template:
#          entity_id: input_select.boys_alarm_sound
#          value: '{{states.input_select.all_alarm_sound.state}}'
#      - service: input_select.select_option
#        data_template:
#          entity_id: input_select.girls_alarm_sound
#          value: '{{states.input_select.all_alarm_sound.state}}'
      - service: input_select.select_option
        data_template:
          entity_id: input_select.masterbed_alarm_sound
          value: '{{states.input_select.all_alarm_sound.state}}'
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.livingroom_alarm_clock_hour
          value: '{{states.input_number.all_alarm_clock_hour.state | float}}'
#      - service: input_number.set_value
#        data_template: 
#          entity_id:
#            - input_number.boys_alarm_clock_hour
#          value: '{{states.input_number.all_alarm_clock_hour.state | float}}'
#      - service: input_number.set_value
#        data_template: 
#          entity_id:
#            - input_number.girls_alarm_clock_hour
#         value: '{{states.input_number.all_alarm_clock_hour.state | float}}'
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.masterbed_alarm_clock_hour
          value: '{{states.input_number.all_alarm_clock_hour.state | float}}'
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.livingroom_alarm_clock_minute
          value: '{{states.input_number.all_alarm_clock_minute.state | float}}'
#      - service: input_number.set_value
#        data_template: 
#          entity_id:
#            - input_number.boys_alarm_clock_minute
#          value: '{{states.input_number.all_alarm_clock_minute.state | float}}'
#      - service: input_number.set_value
#        data_template: 
#          entity_id:
#            - input_number.girls_alarm_clock_minute
#          value: '{{states.input_number.all_alarm_clock_minute.state | float}}'
      - service: input_number.set_value
        data_template: 
          entity_id:
            - input_number.masterbed_alarm_clock_minute
          value: '{{states.input_number.all_alarm_clock_minute.state | float}}'
      - service: input_boolean.turn_on
        data: 
          entity_id:
            - input_boolean.livingroom_alarm_clock_status
#            - input_boolean.boys_alarm_clock_status
#            - input_boolean.girls_alarm_clock_status
            - input_boolean.masterbed_alarm_clock_status
      - service: input_boolean.turn_off
        data:
          entity_id:
            - input_boolean.livingroom_alarm_clock_repeat
#            - input_boolean.boys_alarm_clock_repeat
#            - input_boolean.girls_alarm_clock_repeat
            - input_boolean.masterbed_alarm_clock_repeat